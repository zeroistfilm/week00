<!DOCTYPE html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
          crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/main.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous">
    </script>
    <script>

        let server_location = "54.180.91.148";

        // --------------------------------JH------------------------------------
        // --------------------------------JH------------------------------------
        // --------------------------------JH------------------------------------

        function logout() {
            window.location.href = 'http://' + server_location + '/logout';
        }

        // --------------------------------JH------------------------------------
        // --------------------------------JH------------------------------------
        // --------------------------------JH------------------------------------

        // --------------------------------YD------------------------------------
        // --------------------------------YD------------------------------------
        // --------------------------------YD------------------------------------


        function developHistoryPut(id) {
            console.log(id)


            console.log($("#workhistory" + id).css("display"))
            if ($("#workhistory" + id).css("display") == "none") {
                $("#workhistory" + id).show();
            } else {
                $("#workhistory" + id).hide();
            }
        }

        function insertcontents(id){
            id=id.slice(11,16)

            let title = $("#title"+id).val();
            let contents = $("#contents"+id).val();
            // // 2. memo에 POST 방식으로 메모 생성 요청하기
            $.ajax({
                type: "POST", // POST 방식으로 요청하겠다.
                url: "/develophistory", // /memo라는 url에 요청하겠다.
                data: {title_give: title, contents_give: contents, id_give:id}, // 데이터를 주는 방법
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("포스팅 성공!");
                        // 3. 성공 시 페이지 새로고침하기
                        window.location.reload();
                    } else {
                        alert("서버 오류!")
                    }
                }
            })
        }

        function showDevelopHistory() {


            $.ajax({
                type: "GET", // POST 방식으로 요청하겠다.
                url: "/develophistory", // /memo라는 url에 요청하겠다.
                data: {}, // 데이터를 주는 방법
                success: function (response) {

                    let historys = response["historys"];

                    let id = historys['id']
                    let title = historys['title']
                    let contents = historys['contents']

                    let temphtml = ``
                    let tempid = 0
                    for (let i = 1; i < 19; i++) {
                        temphtml += `<a id="week${i}"  href="#" class="list-group-item list-group-item-action" onclick="showday(id)">week${i}</a>
                            <ul  style="display:none;"  id="weekday${i}"class="list-group list-group-horizontal">
                                      <li id="thu${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">목</li>
                                      <li id="fri${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">금</li>
                                      <li id="sat${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">토</li>
                                      <li id="sun${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">일</li>
                                      <li id="mon${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">월</li>
                                      <li id="tue${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">화</li>
                                      <li id="wed${i}" class="list-group-item list-group-item-action" onclick="developHistoryPut(id)">수</li>
                            </ul>
                                <ur id="workhistorythu${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">thu title</label>
                                        <input id="titlethu${i}"  type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea id="contentsthu${i}" class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                    <button type="button" class="btn btn-outline-primary" onclick="insertcontents(this.parentNode.id)">등록</button>
                                    <button type="button" class="btn btn-outline-success">수정</button>
                                    <button type="button" class="btn btn-outline-secondary">삭제</button>
                                </ur>
                                <ur id="workhistoryfri${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">fri title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                                <ur id="workhistorysat${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">sat title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                                <ur id="workhistorysun${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">sun title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                                <ur id="workhistorymon${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">mon title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                                <ur id="workhistorytue${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">tue title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                                <ur id="workhistorywed${i}" style="display: none;">
                                    <div class="mb-3">
                                        <label for="exampleFormControlInput1" class="form-label">wed title</label>
                                        <input type="email" class="form-control" id="exampleFormControlInput1" placeholder="title">
                                    </div>
                                    <div class="mbz-3">
                                        <label for="exampleFormControlTextarea1" class="form-label">contents</label>
                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3"></textarea>
                                    </div>
                                </ur>
                            `
                    }
                    $("#develophistory").append(temphtml);

                }
            })

        }

        function showday(id) {
            id = id.split('k');
            if ($("#weekday" + id[1]).css("display") == "flex") {
                // post-box를 가리고
                $("#weekday" + id[1]).hide();
                $("#workhistorythu" + id[1]).hide();
                $("#workhistoryfri" + id[1]).hide();
                $("#workhistorysat" + id[1]).hide();
                $("#workhistorysun" + id[1]).hide();
                $("#workhistorymon" + id[1]).hide();
                $("#workhistorytue" + id[1]).hide();
                $("#workhistorywed" + id[1]).hide();
            } else {
                // 아니면(눈에 보이지 않으면) post-box를 펴라
                $("#weekday" + id[1]).show();
            }


        }

        // --------------------------------YD------------------------------------
        // --------------------------------YD------------------------------------
        // --------------------------------YD------------------------------------

        // --------------------------------SH------------------------------------
        // --------------------------------SH------------------------------------
        // --------------------------------SH------------------------------------

        function addQA() {
            console.log('add clicked')
            console.log($("#qadd").css("display"))
            if ($("#qadd").css("display") == 'none') {
                $(`#qadd`).show();
            } else {
                $(`#qadd`).hide();
            }
        }

        function addQARequest(qa_uid, type) {

            text = $(`addquestiontext`).val();
            console.log(text, type)

            $.ajax({
                type: "POST",
                url: `/qna/add`,
                data: {'content_give': text, 'type_give': type},
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("등록 성공");
                        window.location.reload();
                    } else {
                        alert("오류 발생");
                    }
                }
            })
        }

        function deleteQARequest(qa_uid, type) {
            console.log(qa_uid)
            console.log(type)
            $.ajax({
                type: "POST",
                url: `/qna/delete`,
                data: {'id_give': qa_uid, 'type_give': type},
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("삭제 성공");
                        window.location.reload();
                    } else {
                        alert("오류 발생");
                    }
                }
            })
        }

        function modifyQARequest(qa_uid) {
            console.log(qa_uid)
            let question = $('#' + 'mq' + qa_uid).val();
            console.log(question)
            $.ajax({
                type: "POST",
                url: `/qna/modify`,
                data: {'id_give': qa_uid, 'question_give': question},
                success: function (response) { // 성공하면
                    if (response["result"] == "success") {
                        alert("수정 성공");
                        window.location.reload();
                    } else {
                        alert("오류 발생");
                    }
                }
            })
        }

        function modifyQA(qa_uid, question, answer, userkey_q, userkey_a, type) {

            if (type == 'q') {
                console.log('q')
                let card_html = `
             <div class="card" style="width: 34rem;" id=${qa_uid}>
                 <div class="card-body">
                     <p>
                     <input id="mq${qa_uid}" class="form-control", value="${question}"></input>
                     <h6 class="card-subtitle mb-2 text-muted">${userkey_q}</h6>
                     <button type="button" class="btn btn-primary btn-sm" button_number=q${qa_uid} onclick="modifyQARequest('${qa_uid}')">완료</button>
                     <button type="button" class="btn btn-primary btn-sm">취소</button>
                     </p>
                     <p class="card-text">${answer}
                     <h6 class="card-subtitle mb-2 text-muted">${userkey_a}</h6>
                     </p>
                 </div>
             </div>`
                console.log('#' + qa_uid)
                $('#' + qa_uid).html(card_html);
            } else {

            }
        }

        // --------------------------------SH------------------------------------
        // --------------------------------SH------------------------------------
        // --------------------------------SH------------------------------------

    </script>

</head>
<body>
<div class="wrapper">
    <div class="header">
        <div class="header-logo">SW사관학교 정글</div>
        <div class="header-nav-bar">
            <div class="login_status">교육생 조정훈</div>
            <div class="logout" style="cursor: pointer" onclick="logout()">로그아웃</div>
        </div>
    </div>
    <div class="contents">
        <!---------------SH------------------->
        <!---------------SH------------------->
        <!---------------SH------------------->
        <div class="q_and_a">
            <div>Q&A</div>
            <br>
            <button type="button" class="btn btn-primary btn-sm" id="addqbutton" }
                    onclick="addQA()">
                질문하기
            </button>
            <div class="content_name" id="qadd" style="display: none">
                <form>
                    <div class="form-group">
                        <textarea class="form-control" id="addquestiontext" rows="2"></textarea>
                        <button type="button" class="btn btn-primary btn-sm" id="addq" }
                                onclick="addQARequest('q')">
                            완료
                        </button>
                        <button type="button" class="btn btn-primary btn-sm" id="canq" }
                                onclick="cancelQA('q')">
                            취소
                        </button>
                    </div>
                </form>
            </div>
            <div class="content_contents">

                {% for qna in qnas %}
                <div class="card" style="width: 100%;" id={{qna['qa_uid']}}>
                    <div class="card-body">
                        <p>
                            <b><h5 class="card-text">{{qna['question']}}</h5></b>
                        <h6 class="card-subtitle mb-2 text-muted">질문자 : {{qna['userkey_q']}}</h6>
                        <button type="button" class="btn btn-primary btn-sm" button_number=q{{qna['qa_uid']}}
                                onclick="modifyQA('{{qna.qa_uid}}','{{qna.question}}','{{qna.answer}}','{{qna.userkey_q}}','{{qna.userkey_a}}', 'q')">
                            수정
                        </button>
                        <button type="button" class="btn btn-primary btn-sm">답글</button>
                        <button type="button" class="btn btn-primary btn-sm" button_number=dq{{qna['qa_uid']}}
                                onclick="deleteQARequest('{{qna.qa_uid}}','q')">
                            삭제
                        </button>
                        </p>
                        {% if qna['answer'] %}
                        <p class="card-text">{{qna['answer']}}
                        <h6 class="card-subtitle mb-2 text-muted">답변자 : {{qna['userkey_a']}}</h6>
                        <button type="button" class="btn btn-primary btn-sm" button_number=a{{qna['qa_uid']}}
                                onclick="modifyQA('{{qna.qa_uid}}','','{{qna.answer}}','','{{qna.userkey_a}}', 'a')">
                            수정
                        </button>
                        <button type="button" class="btn btn-primary btn-sm" button_number=a{{qna['qa_uid']}}
                                onclick="addQARequest('{{qna.qa_uid}}','{{qna.question}}','{{qna.answer}}','{{qna.userkey_q}}','{{qna.userkey_a}}', 'a')">
                            답글
                        </button>
                        <button type="button" class="btn btn-primary btn-sm" button_number=da{{qna['qa_uid']}}
                                onclick="deleteQARequest('{{qna.qa_uid}}','a')">
                            삭제
                        </button>
                        </p>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        <!---------------SH------------------->
        <!---------------SH------------------->
        <!---------------SH------------------->

        <!---------------JH------------------->
        <!---------------JH------------------->
        <!---------------JH------------------->

        <div class="info">
            <div class="content_name">
                <div>INFOMATION</div>
            </div>
            <div class="content_contents">
                {% set infos = infos_package[0] %}
                {% set infosFinduser = infos_package[1] %}
                {% for info in infos %}
                {% set index = loop.index-1|int %}
                <div id="" class="card" style="width: 100%">
                    <div class="card-header">
                        {{info["title"]}}
                        {{index}}
                    </div>
                    <div class="card-body">
                        <blockquote class="blockquote mb-0">
                            {{info["contents"]}}
                            <footer class="blockquote-footer">
                                {{ infosFinduser[index]['id'] }}
                            </footer>
                        </blockquote>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!---------------JH------------------->
        <!---------------JH------------------->
        <!---------------JH------------------->

        <!---------------YD------------------->
        <!---------------YD------------------->
        <!---------------YD------------------->
        <div class="undefined">
            <div class="content_name">
                <div>Develop History</div>
            </div>
            <div class="content_contents">
                <div id="develophistory" style="width: 100%" class="list-group">




                </div>
            </div>
        </div>
        <!---------------YD------------------->
        <!---------------YD------------------->
        <!---------------YD------------------->
    </div>
    <div class="footer"></div>
</div>
    <script>
        showDevelopHistory();
    </script>
</body>
</html>